<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.0.3 Chrome/140.0.7339.249 Electron/38.7.0 Safari/537.36" version="29.0.3">
  <diagram name="Seckill_Code_3Modes" id="seckill-code-3modes">
    <mxGraphModel dx="2700" dy="1650" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2" value="Seckill（秒杀）按代码实现：三种限购 + Outbox→Relay→RabbitMQ→Order落库 + 状态轮询（严格对照当前代码）" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#1f2937;strokeColor=#111827;fontColor=#ffffff;fontStyle=1;fontSize=16;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="40" y="10" width="2500" height="50" as="geometry" />
        </mxCell>

        <!-- Swimlanes -->
        <mxCell id="10" value="Client（浏览器/前端）" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="260" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="20" value="hmdp-service :8088&#xa;(Controller/Service + Lua入口)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="320" y="80" width="350" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="30" value="Redis Cluster&#xa;(Key 类型+TTL+Lua原子)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff0f5;strokeColor=#b85450;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="690" y="80" width="520" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="40" value="relay-service :8084&#xa;(SeckillRelayWorker×6)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1230" y="80" width="320" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="50" value="RabbitMQ 115.190.193.236&#xa;(durable + persistent)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1570" y="80" width="320" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="60" value="order-service :8083&#xa;(OrderConsumer/OrderProcessor)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1910" y="80" width="320" height="1120" as="geometry" />
        </mxCell>
        <mxCell id="70" value="MySQL 123.56.100.212:3306/hmdp&#xa;(最终一致性落库)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;startSize=30;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="2250" y="80" width="290" height="1120" as="geometry" />
        </mxCell>

        <!-- Client steps -->
        <mxCell id="11" value="A1 商家：创建秒杀券&#xa;POST /voucher/seckill&#xa;limitType=1/2/3" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="10">
          <mxGeometry x="20" y="60" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="12" value="A2 管理员：审核并预热&#xa;POST /voucher/seckill/preheat/{voucherId}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="10">
          <mxGeometry x="20" y="150" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="13" value="B1（仅 type=2/3）&#xa;先取 reqId&#xa;GET /voucher-order/req/{voucherId}?count=N" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="10">
          <mxGeometry x="20" y="270" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="14" value="B2 抢购请求&#xa;POST /voucher-order/seckill/{voucherId}&#xa;reqId(可选) + count" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="10">
          <mxGeometry x="20" y="390" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="15" value="C1 轮询结果&#xa;GET /voucher-order/status?reqId=..." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="10">
          <mxGeometry x="20" y="930" width="220" height="60" as="geometry" />
        </mxCell>

        <!-- hmdp-service steps -->
        <mxCell id="21" value="VoucherController&#xa;POST /voucher/seckill" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" vertex="1" parent="20">
          <mxGeometry x="20" y="60" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="22" value="VoucherServiceImpl.addSeckillVoucher&#xa;1) 校验店铺创建者/管理员&#xa;2) INSERT tb_voucher(type=1)&#xa;3) INSERT tb_seckill_voucher(stock,begin,end,limitType,userLimit)&#xa;4) 商家创建→preheat_status=0&#xa;   管理员创建→写 Redis stock + preheat_status=2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="20">
          <mxGeometry x="20" y="120" width="300" height="140" as="geometry" />
        </mxCell>
        <mxCell id="23" value="VoucherController&#xa;POST /voucher/seckill/preheat/{id}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" vertex="1" parent="20">
          <mxGeometry x="20" y="270" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="24" value="VoucherServiceImpl.preheatSeckillVoucher&#xa;1) 校验 ADMIN(role)&#xa;2) SELECT tb_seckill_voucher&#xa;3) SET Redis stockKey&#xa;4) UPDATE preheat_status=2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="20">
          <mxGeometry x="20" y="330" width="300" height="110" as="geometry" />
        </mxCell>
        <mxCell id="25" value="VoucherOrderController&#xa;GET /voucher-order/req/{id}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" vertex="1" parent="20">
          <mxGeometry x="20" y="460" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="26" value="VoucherOrderServiceImpl.generateRequestId&#xa;仅限 type=2/3：&#xa;1) 校验活动未结束&#xa;2) type=3 校验 count&lt;=userLimit&#xa;3) reqId = RedisIdWorker.nextId(&quot;req&quot;)&#xa;4) SET tokenKey(reqId)=voucherId:userId TTL=10m" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="20">
          <mxGeometry x="20" y="520" width="300" height="120" as="geometry" />
        </mxCell>
        <mxCell id="27" value="VoucherOrderController&#xa;POST /voucher-order/seckill/{id}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" vertex="1" parent="20">
          <mxGeometry x="20" y="660" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="28" value="VoucherOrderServiceImpl.seckillVoucher&#xa;1) SELECT tb_seckill_voucher(时间/limitType/userLimit/preheat_status)&#xa;2) 检查 Redis stockKey 存在(未预热则拒绝)&#xa;3) resolvedReqId：&#xa;   type=1 → MD5(voucherId:userId)&#xa;   type=2/3 → validateRequestToken(reqId) 校验 tokenKey 绑定&#xa;4) orderId=RedisIdWorker.nextId(&quot;order&quot;)&#xa;5) 执行 Lua(seckill.lua) 传入 keys+payloadJson&#xa;6) 返回 resolvedReqId(用于轮询)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="20">
          <mxGeometry x="20" y="720" width="300" height="170" as="geometry" />
        </mxCell>
        <mxCell id="29" value="VoucherOrderServiceImpl.queryStatus&#xa;GET statusKey → 返回 {PENDING/SUCCESS/FAILED}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=11;" vertex="1" parent="20">
          <mxGeometry x="20" y="930" width="300" height="60" as="geometry" />
        </mxCell>

        <!-- Redis keys & Lua -->
        <mxCell id="31" value="String&#xa;stockKey&#xa;seckill:{seckill}:stock:&lt;voucherId&gt;&#xa;val=库存(int)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="30">
          <mxGeometry x="20" y="60" width="230" height="80" as="geometry" />
        </mxCell>
        <mxCell id="32" value="String&#xa;tokenKey&#xa;seckill:{seckill}:token:&lt;reqId&gt;&#xa;val=voucherId:userId&#xa;TTL=10m" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="30">
          <mxGeometry x="20" y="460" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="33" value="Lua：hmdp-service/resources/seckill.lua&#xa;keys=[stock, orderSet, userCountHash, outbox, reqKey, statusKey]&#xa;流程（原子）：&#xa;0) EXISTS reqKey → return 0(幂等成功)&#xa;1) GET stock &amp; stock&lt;count → status=FAILED(STOCK), SETEX reqKey=FAIL, return 1&#xa;2) limitType=1：SISMEMBER orderSet userId → FAILED(LIMIT), SETEX reqKey=FAIL, return 2&#xa;   limitType=3：HGET+校验 used+count&lt;=userLimit → 否则 FAILED(LIMIT), SETEX reqKey=FAIL, return 2&#xa;3) INCRBY stock -count&#xa;4) limitType=1：SADD orderSet userId&#xa;   limitType=3：HINCRBY userCountHash userId count&#xa;5) SET reqKey=orderId EX=1800&#xa;6) SET statusKey=PENDING EX=1800&#xa;7) LPUSH outbox payloadJson" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="30">
          <mxGeometry x="270" y="430" width="230" height="320" as="geometry" />
        </mxCell>
        <mxCell id="34" value="Set&#xa;orderSetKey&#xa;seckill:{seckill}:order:&lt;voucherId&gt;&#xa;member=userId&#xa;（限购=一人一单）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="30">
          <mxGeometry x="20" y="570" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="35" value="Hash&#xa;userCountHashKey&#xa;seckill:{seckill}:usercount:&lt;voucherId&gt;&#xa;field=userId → ownedCount&#xa;（限购=累计限购）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="30">
          <mxGeometry x="20" y="670" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="36" value="String&#xa;reqKey（入口幂等）&#xa;seckill:{seckill}:req:&lt;reqId&gt;&#xa;val=orderId 或 FAIL&#xa;TTL=1800s" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="30">
          <mxGeometry x="270" y="760" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="37" value="String&#xa;statusKey（轮询）&#xa;seckill:{seckill}:status:&lt;reqId&gt;&#xa;val={status,orderId,voucherId,userId,count,reason?}&#xa;TTL=1800s/30m&#xa;（Lua写PENDING；order-service覆盖SUCCESS/FAILED）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="30">
          <mxGeometry x="270" y="860" width="230" height="120" as="geometry" />
        </mxCell>
        <mxCell id="38" value="List&#xa;outboxKey&#xa;seckill:{seckill}:outbox&#xa;LPUSH payloadJson&#xa;（Relay 多线程搬运）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="30">
          <mxGeometry x="20" y="780" width="230" height="80" as="geometry" />
        </mxCell>

        <!-- Relay -->
        <mxCell id="41" value="SeckillRelayWorker.start()&#xa;线程池=6&#xa;每线程：RPOPLPUSH outbox→relay:queue:i&#xa;（崩溃可重试，防丢）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="40">
          <mxGeometry x="20" y="650" width="280" height="110" as="geometry" />
        </mxCell>
        <mxCell id="42" value="RabbitTemplate.convertAndSend&#xa;exchange=seckillExchange&#xa;routingKey=seckill.message&#xa;CorrelationData + PublisherConfirm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="40">
          <mxGeometry x="20" y="770" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="43" value="ACK → LREM relay:queue:i 1 payload&#xa;NACK/异常 → payload 留在 relay:queue:i 等待重发" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="40">
          <mxGeometry x="20" y="870" width="280" height="80" as="geometry" />
        </mxCell>

        <!-- RabbitMQ -->
        <mxCell id="51" value="Exchange&#xa;seckillExchange&#xa;durable=true" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d79b00;fontSize=12;" vertex="1" parent="50">
          <mxGeometry x="80" y="670" width="160" height="70" as="geometry" />
        </mxCell>
        <mxCell id="52" value="Queue&#xa;seckillQueue&#xa;durable=true" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d79b00;fontStyle=1;fontSize=12;" vertex="1" parent="50">
          <mxGeometry x="60" y="770" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="53" value="Message deliveryMode=2&#xa;(persistent)&#xa;+ Disk store(mnesia)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;" vertex="1" parent="50">
          <mxGeometry x="190" y="860" width="70" height="70" as="geometry" />
        </mxCell>

        <!-- Order-service -->
        <mxCell id="61" value="OrderConsumer&#xa;@RabbitListener(seckillQueue)&#xa;parse JSON → OrderMessage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="60">
          <mxGeometry x="20" y="670" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="62" value="OrderProcessor.process()（@Transactional）&#xa;1) 幂等：SELECT tb_voucher_order WHERE request_id=?&#xa;2) 限购：&#xa;   type=1 → DB count(user,voucher)&gt;0 拒绝&#xa;   type=3 → upsert tb_user_quota(owned_count+count&lt;=limit)&#xa;3) 扣库存：UPDATE tb_seckill_voucher SET stock=stock-count WHERE stock&gt;=count&#xa;4) INSERT tb_voucher_order(id=orderId, request_id unique)&#xa;5) 写状态：SET statusKey=SUCCESS/FAILED TTL=30m&#xa;6) basicAck()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=10;align=left;" vertex="1" parent="60">
          <mxGeometry x="20" y="760" width="280" height="250" as="geometry" />
        </mxCell>

        <!-- MySQL tables -->
        <mxCell id="71" value="tb_voucher&#xa;- id (PK)&#xa;- shop_id(FK)&#xa;- type(0普通/1秒杀)&#xa;- limit_type,user_limit&#xa;- status&#xa;- create_time" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="70">
          <mxGeometry x="20" y="70" width="250" height="130" as="geometry" />
        </mxCell>
        <mxCell id="72" value="tb_seckill_voucher&#xa;- voucher_id(PK/FK→tb_voucher.id)&#xa;- stock&#xa;- begin_time,end_time&#xa;- limit_type,user_limit&#xa;- preheat_status(0/2)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="70">
          <mxGeometry x="20" y="220" width="250" height="140" as="geometry" />
        </mxCell>
        <mxCell id="73" value="tb_voucher_order&#xa;- id(PK=orderId)&#xa;- request_id UNIQUE&#xa;- user_id(FK)&#xa;- voucher_id(FK)&#xa;- limit_type,user_limit,count&#xa;- create_time" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="70">
          <mxGeometry x="20" y="380" width="250" height="150" as="geometry" />
        </mxCell>
        <mxCell id="74" value="tb_user_quota（累计限购）&#xa;- PK(user_id,voucher_id)&#xa;- owned_count&#xa;SQL: INSERT ... ON DUPLICATE KEY UPDATE ...&#xa;（原子 upsert+限额判定）" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=10;align=left;" vertex="1" parent="70">
          <mxGeometry x="20" y="550" width="250" height="160" as="geometry" />
        </mxCell>

        <!-- Why callouts (short) -->
        <mxCell id="80" value="WHY: type=1 使用确定性 reqId=MD5(voucherId:userId)&#xa;→ 网络超时重试仍是同一单；Redis/Lua/DB 都可做幂等" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7ed;strokeColor=#fb923c;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="1220" width="520" height="60" as="geometry" />
        </mxCell>
        <mxCell id="81" value="WHY: tokenKey 绑定(reqId ↔ voucherId:userId) + TTL&#xa;→ 防伪造 reqId；限制“只对当前用户/券有效”的一次购买意图" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7ed;strokeColor=#fb923c;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="860" y="1220" width="520" height="60" as="geometry" />
        </mxCell>
        <mxCell id="82" value="WHY: Outbox + Relay(Confirm) + MQ durable+persistent + DB request_id UNIQUE&#xa;→ 端到端至少一次投递；最终一致落库且可幂等" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7ed;strokeColor=#fb923c;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="1400" y="1220" width="520" height="60" as="geometry" />
        </mxCell>

        <!-- Edges -->
        <mxCell id="e1" value="HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="11" target="21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" value="DB写入" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;dashed=1;" edge="1" parent="1" source="22" target="71">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" value="HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="12" target="23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4" value="SET stockKey + UPDATE preheat_status" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="24" target="31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5" value="HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="13" target="25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e6" value="SET tokenKey" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="26" target="32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e7" value="HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="14" target="27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e8" value="EVAL seckill.lua" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="28" target="33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e9" value="LPUSH outbox" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="33" target="38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e10" value="RPOPLPUSH + publish" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="38" target="41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e11" value="AMQP publish" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="42" target="51">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e12" value="route" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="51" target="52">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e13" value="consume" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="52" target="61">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e14" value="写订单/扣库存/配额" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;dashed=1;" edge="1" parent="1" source="62" target="73">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e15" value="写 statusKey" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="62" target="37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e16" value="HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="15" target="29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e17" value="GET statusKey" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" parent="1" source="29" target="37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
