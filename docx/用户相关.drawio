<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36" version="28.2.9">
  <diagram name="第 1 页" id="tA-PUAyLh7GDNycLSTZq">
    <mxGraphModel dx="983" dy="513" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-1" value="发送验证码流程 (POST /user/code) - 多级限流防刷机制" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2300" y="50" width="700" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-2" value="开始: phone(邮箱)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2520" y="130" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-3" value="检查一级限制&lt;br/&gt;Redis SISMEMBER&lt;br/&gt;limit:onelevel:{phone}" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2490" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-4" value="在一级限制?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2520" y="290" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-5" value="返回fail&lt;br/&gt;&quot;需要等5分钟后再请求&quot;" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2750" y="290" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-6" value="检查二级限制&lt;br/&gt;Redis SISMEMBER&lt;br/&gt;limit:twolevel:{phone}" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2490" y="370" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-7" value="在二级限制?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2520" y="460" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-8" value="返回fail&lt;br/&gt;&quot;需要等20分钟后再请求&quot;" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2750" y="460" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-9" value="检查1分钟内发送次数&lt;br/&gt;Redis ZCOUNT&lt;br/&gt;sms:sendtime:{phone}&lt;br/&gt;(now-60s, now)" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2470" y="540" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-10" value="count &gt;= 1?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2520" y="640" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-11" value="返回fail&lt;br/&gt;&quot;请1分钟后重试&quot;" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2750" y="640" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-12" value="检查5分钟内发送次数&lt;br/&gt;Redis ZCOUNT&lt;br/&gt;sms:sendtime:{phone}&lt;br/&gt;(now-5min, now)" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2470" y="720" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-13" value="count%3==2 且&lt;br/&gt;count&gt;5?&lt;br/&gt;(8,11,14...次)" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2505" y="820" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-14" value="触发二级限制&lt;br/&gt;Redis SADD + EXPIRE&lt;br/&gt;limit:twolevel:{phone}&lt;br/&gt;TTL: 20分钟" style="whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2750" y="820" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-15" value="count == 5?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2520" y="920" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-16" value="触发一级限制&lt;br/&gt;Redis SADD + EXPIRE&lt;br/&gt;limit:onelevel:{phone}&lt;br/&gt;TTL: 5分钟" style="whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2750" y="920" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-17" value="生成6位随机验证码&lt;br/&gt;MailUtils.achieveCode()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2500" y="1020" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-18" value="Redis SET&lt;br/&gt;login:code:{phone} = code&lt;br/&gt;TTL: 2分钟" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2480" y="1100" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-19" value="发送邮件&lt;br/&gt;MailUtils.sendtoMail()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2500" y="1200" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-20" value="记录发送时间&lt;br/&gt;Redis ZADD&lt;br/&gt;sms:sendtime:{phone}&lt;br/&gt;score=timestamp" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2470" y="1280" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-21" value="返回Result.ok()" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;fontFamily=Comic Sans MS;" parent="1" vertex="1">
          <mxGeometry x="2520" y="1380" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-22" value="Redis 限流数据&lt;br/&gt;&lt;br/&gt;Set: limit:onelevel:{phone}&lt;br/&gt;TTL: 5分钟&lt;br/&gt;&lt;br/&gt;Set: limit:twolevel:{phone}&lt;br/&gt;TTL: 20分钟&lt;br/&gt;&lt;br/&gt;ZSet: sms:sendtime:{phone}&lt;br/&gt;记录所有发送时间戳&lt;br/&gt;无TTL（持久）" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffcccc;strokeColor=#b85450;fontFamily=Comic Sans MS;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="3050" y="200" width="200" height="220" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-23" value="Redis 验证码&lt;br/&gt;&lt;br/&gt;String: login:code:{phone}&lt;br/&gt;value: &quot;123456&quot;&lt;br/&gt;TTL: 2分钟" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffcccc;strokeColor=#b85450;fontFamily=Comic Sans MS;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="3050" y="1100" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-24" value="设计要点:&lt;br/&gt;1. 三级限流机制: 1分钟1次 → 5分钟5次(一级5min禁止) → 8/11/14次(二级20min禁止)&lt;br/&gt;2. ZSet滑动窗口: 使用ZCOUNT统计时间范围内的次数，精确控制频率&lt;br/&gt;3. Set标记封禁: 一级/二级限制用Set+TTL标记，到期自动解除&lt;br/&gt;4. 验证码TTL: 2分钟过期，平衡安全性和用户体验&lt;br/&gt;5. 无持久化验证码: 登录成功后立即删除，防止重复使用&lt;br/&gt;6. 递进式惩罚: 轻度违规短时禁止，重度违规长时禁止，防止恶意刷验证码" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;fontFamily=Comic Sans MS;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="2300" y="1460" width="700" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-2" target="Si3AXrKBGMQPG3Cq1DsE-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-3" target="Si3AXrKBGMQPG3Cq1DsE-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-27" value="是 (被封禁)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-4" target="Si3AXrKBGMQPG3Cq1DsE-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-28" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-4" target="Si3AXrKBGMQPG3Cq1DsE-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-6" target="Si3AXrKBGMQPG3Cq1DsE-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-30" value="是 (被封禁)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-7" target="Si3AXrKBGMQPG3Cq1DsE-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-31" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-7" target="Si3AXrKBGMQPG3Cq1DsE-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-9" target="Si3AXrKBGMQPG3Cq1DsE-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-33" value="是 (频繁)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-10" target="Si3AXrKBGMQPG3Cq1DsE-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-34" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-10" target="Si3AXrKBGMQPG3Cq1DsE-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-12" target="Si3AXrKBGMQPG3Cq1DsE-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-36" value="是 (严重违规)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-13" target="Si3AXrKBGMQPG3Cq1DsE-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-37" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-13" target="Si3AXrKBGMQPG3Cq1DsE-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-38" value="是 (达到阈值)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-15" target="Si3AXrKBGMQPG3Cq1DsE-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-39" value="否 (正常)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-15" target="Si3AXrKBGMQPG3Cq1DsE-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-17" target="Si3AXrKBGMQPG3Cq1DsE-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-18" target="Si3AXrKBGMQPG3Cq1DsE-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-19" target="Si3AXrKBGMQPG3Cq1DsE-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-43" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-20" target="Si3AXrKBGMQPG3Cq1DsE-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-44" value="SISMEMBER" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-3" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-45" value="SISMEMBER" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-6" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-46" value="ZCOUNT" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-9" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-47" value="ZCOUNT" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-12" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-48" value="SADD+EXPIRE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-14" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-49" value="SADD+EXPIRE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-16" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-50" value="ZADD" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-20" target="Si3AXrKBGMQPG3Cq1DsE-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-51" value="SET+EXPIRE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;fontFamily=Comic Sans MS;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-18" target="Si3AXrKBGMQPG3Cq1DsE-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-52" value="开始: POST /user/login&#xa;接收参数: phone, code" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="50" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-53" value="第一次邮箱格式校验&#xa;RegexUtils.isEmailInvalid(phone)?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="150" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-54" value="返回失败&#xa;&quot;邮箱格式不正确！！&quot;" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="150" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-55" value="从Redis查询验证码&#xa;key: login:code:{phone}" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="260" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-56" value="第二次邮箱格式校验&#xa;RegexUtils.isEmailInvalid(phone)?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="370" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-57" value="返回失败&#xa;&quot;邮箱格式不正确！！&quot;" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="370" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-58" value="验证码校验&#xa;code == Cachecode?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="480" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-59" value="返回失败&#xa;&quot;无效的验证码&quot;" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="480" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-60" value="从MySQL查询用户&#xa;SELECT * FROM tb_user WHERE phone=?" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="590" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-61" value="用户是否存在?&#xa;user == null?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="700" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-62" value="创建新用户 createuser()&#xa;1. 设置phone&#xa;2. 生成随机昵称&#xa;3. INSERT INTO tb_user" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="450" y="700" width="220" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-63" value="生成UUID Token&#xa;token = UUID.randomUUID().toString()" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="860" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-64" value="转换为UserDTO&#xa;userDTO = BeanUtil.copyProperties(user, UserDTO.class)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="970" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-65" value="转换为HashMap&#xa;userMap.put(&quot;id&quot;, id)&#xa;userMap.put(&quot;nickName&quot;, nickName)&#xa;userMap.put(&quot;icon&quot;, icon)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="1080" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-66" value="存储到Redis Hash&#xa;HMSET login:token:{token} userMap" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="1210" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-67" value="设置TTL 30分钟&#xa;EXPIRE login:token:{token} 36000" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="1320" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-68" value="删除验证码&#xa;DEL login:code:{phone}" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="1430" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-69" value="返回成功&#xa;Result.ok(token)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="1540" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-70" value="Redis缓存&#xa;&#xa;1. login:code:{phone}&#xa;   String, TTL=2min&#xa;   存储验证码&#xa;&#xa;2. login:token:{token}&#xa;   Hash, TTL=30min&#xa;   {id, nickName, icon}" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;fontSize=12;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="800" y="200" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-71" value="MySQL数据库&#xa;&#xa;tb_user表:&#xa;- id (主键)&#xa;- phone (登录凭证)&#xa;- password&#xa;- nick_name&#xa;- icon&#xa;- create_time" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=12;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="800" y="550" width="240" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-52" target="Si3AXrKBGMQPG3Cq1DsE-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-73" value="是(无效)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-53" target="Si3AXrKBGMQPG3Cq1DsE-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-74" value="否(有效)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-53" target="Si3AXrKBGMQPG3Cq1DsE-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-75" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-55" target="Si3AXrKBGMQPG3Cq1DsE-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-76" value="是(无效)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-56" target="Si3AXrKBGMQPG3Cq1DsE-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-77" value="否(有效)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-56" target="Si3AXrKBGMQPG3Cq1DsE-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-78" value="否(不匹配)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-58" target="Si3AXrKBGMQPG3Cq1DsE-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-79" value="是(匹配)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-58" target="Si3AXrKBGMQPG3Cq1DsE-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-80" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-60" target="Si3AXrKBGMQPG3Cq1DsE-61" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-81" value="是(新用户)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-61" target="Si3AXrKBGMQPG3Cq1DsE-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-62" target="Si3AXrKBGMQPG3Cq1DsE-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-83" value="否(老用户)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-61" target="Si3AXrKBGMQPG3Cq1DsE-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-63" target="Si3AXrKBGMQPG3Cq1DsE-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-85" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-64" target="Si3AXrKBGMQPG3Cq1DsE-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-65" target="Si3AXrKBGMQPG3Cq1DsE-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-87" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-66" target="Si3AXrKBGMQPG3Cq1DsE-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-88" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-67" target="Si3AXrKBGMQPG3Cq1DsE-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-89" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-68" target="Si3AXrKBGMQPG3Cq1DsE-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-90" value="GET" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-55" target="Si3AXrKBGMQPG3Cq1DsE-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-91" value="HMSET" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-66" target="Si3AXrKBGMQPG3Cq1DsE-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-92" value="EXPIRE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-67" target="Si3AXrKBGMQPG3Cq1DsE-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-93" value="DEL" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-68" target="Si3AXrKBGMQPG3Cq1DsE-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-94" value="SELECT" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-60" target="Si3AXrKBGMQPG3Cq1DsE-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-95" value="INSERT" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-62" target="Si3AXrKBGMQPG3Cq1DsE-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-96" value="【设计说明 - 登录/注册流程】&#xa;&#xa;1. 双重邮箱校验：代码中有两次校验（line 110和118），确保安全性&#xa;2. 验证码存储：Redis String类型，TTL=2分钟，登录成功后立即删除&#xa;3. 自动注册：首次登录用户自动创建账号，设置随机昵称&#xa;4. Token机制：UUID生成，存储UserDTO的HashMap到Redis Hash&#xa;5. 会话管理：Token TTL=30分钟（36000秒），由RefreshTokenInterceptor刷新&#xa;6. 缓存策略：登录成功后写入缓存，验证码用后即焚（DEL）&#xa;7. 数据转换：User -&gt; UserDTO -&gt; HashMap，只存储必要字段（id, nickName, icon）&#xa;&#xa;代码位置：UserServiceImpl.java:106-159" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="1680" width="620" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-97" value="开始: POST /user/sign&#xa;用户签到请求" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="2000" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-98" value="从ThreadLocal获取当前用户&#xa;UserHolder.getUser().getId()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="2100" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-99" value="获取当前日期时间&#xa;LocalDateTime.now()" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="2200" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-100" value="拼接Redis Key&#xa;keySuffix = &quot;:yyyyMM&quot;&#xa;key = &quot;sign:&quot; + userId + keySuffix" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="2300" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-101" value="计算今天是本月第几天&#xa;dayOfMonth = now.getDayOfMonth()" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="2420" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-102" value="写入Redis Bitmap&#xa;SETBIT key (dayOfMonth-1) 1&#xa;偏移量从0开始，所以减1" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="2520" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-103" value="返回成功&#xa;Result.ok()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="2640" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-104" value="Redis Bitmap存储&#xa;&#xa;Key: sign:{userId}:yyyyMM&#xa;例如: sign:1010:202501&#xa;&#xa;数据结构: Bitmap&#xa;- 每个bit代表一天&#xa;- offset 0 = 1号&#xa;- offset 1 = 2号&#xa;- ...&#xa;- offset 30 = 31号&#xa;&#xa;bit=1表示已签到&#xa;bit=0表示未签到&#xa;&#xa;优势: 一个月最多31bit，&#xa;极其节省内存！" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="450" y="2200" width="280" height="320" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-105" value="ThreadLocal用户上下文&#xa;&#xa;UserHolder存储当前请求用户&#xa;由RefreshTokenInterceptor&#xa;在每次请求时从Redis读取&#xa;login:token:{token}&#xa;并放入ThreadLocal" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="450" y="2000" width="280" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-106" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-97" target="Si3AXrKBGMQPG3Cq1DsE-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-107" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-98" target="Si3AXrKBGMQPG3Cq1DsE-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-108" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-99" target="Si3AXrKBGMQPG3Cq1DsE-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-109" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-100" target="Si3AXrKBGMQPG3Cq1DsE-101" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-110" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-101" target="Si3AXrKBGMQPG3Cq1DsE-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-111" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-102" target="Si3AXrKBGMQPG3Cq1DsE-103" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="210" y="2600" as="sourcePoint" />
            <mxPoint x="210" y="2640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-112" value="读取" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-98" target="Si3AXrKBGMQPG3Cq1DsE-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-113" value="SETBIT" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-102" target="Si3AXrKBGMQPG3Cq1DsE-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-114" value="【设计说明 - 签到功能】&lt;br&gt;&lt;br&gt;1. Bitmap优势：一个用户一个月的签到记录只占31bit（约4字节），百万用户仅需4MB！&lt;br&gt;2. Key设计：按月分区 sign:{userId}:yyyyMM，避免单个key过大&lt;br&gt;3. offset计算：dayOfMonth从1开始，但bitmap offset从0开始，需要-1&lt;br&gt;4. 幂等性：重复签到会覆盖，SETBIT返回旧值可判断是否重复签到&lt;br&gt;5. 无TTL：签到记录需要永久保存，用于统计连续签到天数" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="2760" width="680" height="150" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-115" value="开始: GET /user/sign/count&#xa;统计连续签到天数" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="3000" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-116" value="获取当前用户ID&#xa;UserHolder.getUser().getId()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="3100" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-117" value="获取当前日期&#xa;LocalDateTime.now()" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="3200" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-118" value="拼接Redis Key&#xa;keySuffix = &quot;:yyyyMM&quot;&#xa;key = &quot;sign:&quot; + userId + keySuffix" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="3300" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-119" value="计算今天是本月第几天&#xa;dayOfMonth = now.getDayOfMonth()" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="3420" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-120" value="从Redis读取签到数据&#xa;BITFIELD key &#xa;GET u{dayOfMonth} 0&#xa;获取从第0位开始的dayOfMonth个bit" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="3520" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-121" value="result为空或空列表?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="3660" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-122" value="返回0天&#xa;Result.ok(0)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="3660" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-123" value="初始化计数器&#xa;count = 0&#xa;num = result.get(0) (十进制数)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="3750" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-124" value="位运算检查最低位&#xa;(num &amp; 1) == 0 ?&#xa;（与1做AND运算，检查最后一位）" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="3880" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-125" value="最低位=0，未签到&#xa;连续签到中断&#xa;跳出循环" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="450" y="3880" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-126" value="计数器+1&#xa;count++" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="110" y="3990" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-127" value="无符号右移1位&#xa;num = num &gt;&gt;&gt; 1&#xa;抛弃最后一位，准备检查下一位" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="4100" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-128" value="返回连续签到天数&#xa;Result.ok(count)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="390" y="4110" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-129" value="Redis Bitmap数据&#xa;&#xa;Key: sign:{userId}:yyyyMM&#xa;&#xa;BITFIELD命令:&#xa;GET u5 0 表示获取&#xa;从offset 0开始的&#xa;5个无符号bit&#xa;&#xa;示例（假设今天5号）：&#xa;offset: 0 1 2 3 4&#xa;bit:    1 1 0 1 1&#xa;表示：1号✓ 2号✓ 3号✗ 4号✓ 5号✓&#xa;&#xa;返回的十进制数：&#xa;二进制 11011 = 十进制 27&#xa;&#xa;从最低位开始检查：&#xa;27 &amp; 1 = 1 (5号✓)&#xa;13 &amp; 1 = 1 (4号✓)&#xa;6 &amp; 1 = 0 (3号✗ 中断！)&#xa;连续签到2天" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="800" y="3200" width="280" height="380" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-130" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-115" target="Si3AXrKBGMQPG3Cq1DsE-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-131" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-116" target="Si3AXrKBGMQPG3Cq1DsE-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-132" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-117" target="Si3AXrKBGMQPG3Cq1DsE-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-133" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-118" target="Si3AXrKBGMQPG3Cq1DsE-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-134" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-119" target="Si3AXrKBGMQPG3Cq1DsE-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-135" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-120" target="Si3AXrKBGMQPG3Cq1DsE-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-136" value="是(空)" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-121" target="Si3AXrKBGMQPG3Cq1DsE-122" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-137" value="否(有数据)" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-121" target="Si3AXrKBGMQPG3Cq1DsE-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-138" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-123" target="Si3AXrKBGMQPG3Cq1DsE-124" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-139" value="是(=0)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-124" target="Si3AXrKBGMQPG3Cq1DsE-125" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-140" value="否(=1)" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-124" target="Si3AXrKBGMQPG3Cq1DsE-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-141" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-126" target="Si3AXrKBGMQPG3Cq1DsE-127" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-142" value="循环检查下一位" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-127" target="Si3AXrKBGMQPG3Cq1DsE-124" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-143" value="break" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-125" target="Si3AXrKBGMQPG3Cq1DsE-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-144" value="BITFIELD GET" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-120" target="Si3AXrKBGMQPG3Cq1DsE-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-145" value="【设计说明 - 统计连续签到】&lt;br&gt;&lt;br&gt;1. BITFIELD优势：一次性读取多个bit，比循环GETBIT高效&lt;br&gt;2. 位运算核心：num &amp;amp; 1 检查最低位，num &amp;gt;&amp;gt;&amp;gt; 1 右移抛弃已检查的位&lt;br&gt;3. 为什么从最低位开始：BITFIELD返回的是小端序，offset 0的bit在最低位&lt;br&gt;4. 循环终止条件：遇到0（未签到）立即break，这样只统计&quot;连续&quot;签到&lt;br&gt;5. 边界case：如果今天未签到，第一次 &amp;amp; 1 就是0，直接返回count=0&lt;br&gt;6. 时间复杂度：O(n)，n是dayOfMonth，最多31次循环&lt;br&gt;7. 示例演算：11011(二进制) → 检查最低位1✓ → 右移得1101 → 检查最低位1✓ → 右移得110 → 检查最低位0✗ → break，连续2天&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="4340" width="680" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-146" value="开始: GET /user/me&#xa;获取当前登录用户" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="4600" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-147" value="从ThreadLocal获取用户&#xa;UserHolder.getUser()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="4700" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-148" value="返回UserDTO&#xa;Result.ok(user)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="5020" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-149" value="开始: GET /user/{id}&#xa;查询用户基本信息" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="4600" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-150" value="从MySQL查询User&#xa;userService.getById(userId)" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="4700" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-151" value="user == null?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="4800" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-152" value="返回空&#xa;Result.ok()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="850" y="4800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-153" value="转换为UserDTO&#xa;BeanUtil.copyProperties(user, UserDTO)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="450" y="4920" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-154" value="返回UserDTO&#xa;Result.ok(userDTO)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="5020" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-155" value="开始: GET /user/info/{id}&#xa;查询用户详细信息" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="5140" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-156" value="从MySQL查询UserInfo&#xa;userInfoService.getById(userId)" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="5240" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-157" value="info == null?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="5340" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-158" value="返回空（首次查看）&#xa;Result.ok()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="5340" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-159" value="清除时间戳字段&#xa;info.setCreateTime(null)&#xa;info.setUpdateTime(null)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="5460" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-160" value="返回UserInfo&#xa;Result.ok(info)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="5580" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-161" value="&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;MySQL数据库&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;tb_user表:&lt;br&gt;基本信息&lt;br&gt;id, phone, nick_name, icon&lt;/blockquote&gt;&lt;br&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;tb_user_info表:&lt;br&gt;扩展信息（外键user_id）&lt;br&gt;city, introduce, fans,&lt;br&gt; followee, gender, birthday&lt;/blockquote&gt;" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="810" y="5000" width="240" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-162" value="ThreadLocal用户上下文&#xa;&#xa;UserHolder中存储的&#xa;是UserDTO，包含：&#xa;- id&#xa;- nickName&#xa;- icon" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="220" y="4830" width="130" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-163" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-146" target="Si3AXrKBGMQPG3Cq1DsE-147" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-164" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-147" target="Si3AXrKBGMQPG3Cq1DsE-148" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-165" value="读取" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-147" target="Si3AXrKBGMQPG3Cq1DsE-162" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-166" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-149" target="Si3AXrKBGMQPG3Cq1DsE-150" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-167" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-150" target="Si3AXrKBGMQPG3Cq1DsE-151" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-168" value="是" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-151" target="Si3AXrKBGMQPG3Cq1DsE-152" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-169" value="否" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-151" target="Si3AXrKBGMQPG3Cq1DsE-153" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-170" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-153" target="Si3AXrKBGMQPG3Cq1DsE-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-171" value="SELECT tb_user" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-150" target="Si3AXrKBGMQPG3Cq1DsE-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-172" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-155" target="Si3AXrKBGMQPG3Cq1DsE-156" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-173" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-156" target="Si3AXrKBGMQPG3Cq1DsE-157" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-174" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-157" target="Si3AXrKBGMQPG3Cq1DsE-158" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-175" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-157" target="Si3AXrKBGMQPG3Cq1DsE-159" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-176" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-159" target="Si3AXrKBGMQPG3Cq1DsE-160" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-177" value="SELECT tb_user_info" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-156" target="Si3AXrKBGMQPG3Cq1DsE-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-178" value="【设计说明 - 用户信息查询】&#xa;&#xa;1. 三种查询接口：&#xa;   - GET /user/me: 获取当前登录用户（从ThreadLocal读取，无数据库查询，最快）&#xa;   - GET /user/{id}: 查询基本信息（tb_user表，返回UserDTO隐藏敏感字段如phone）&#xa;   - GET /user/info/{id}: 查询详细信息（tb_user_info表，垂直分表设计）&#xa;&#xa;2. 垂直分表优势：高频字段（昵称、头像）和低频字段（城市、生日）分离，提升查询性能&#xa;3. 无缓存设计：用户信息查询频率低，直接查数据库，无需Redis缓存&#xa;4. 隐私保护：清除时间戳字段，避免泄露用户注册时间等敏感信息&#xa;5. UserDTO vs User: DTO只包含公开字段（id, nickName, icon），隐藏phone等敏感信息&#xa;&#xa;代码位置：UserController.java:69-101" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="5700" width="1040" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-179" value="开始: GET /follow/list&#xa;查询我的关注列表" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="5940" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-180" value="获取当前用户ID&#xa;UserHolder.getUser().getId()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="6040" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-181" value="从Redis获取关注列表&#xa;SMEMBERS follows:{userId}&#xa;返回所有关注的用户ID" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="6140" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-182" value="关注列表为空?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="6260" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-183" value="返回空列表&#xa;Result.ok(emptyList)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="6260" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-184" value="转换为Long列表&#xa;ids = Set&lt;String&gt;.map(Long::valueOf)&#xa;.collect(toList())" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="6360" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-185" value="批量查询用户信息&#xa;SELECT * FROM tb_user&#xa;WHERE id IN (ids)" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="6480" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-186" value="转换为UserDTO列表&#xa;users.stream().map(user -&gt;&#xa;  BeanUtil.copyProperties(user, UserDTO))" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="6600" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-187" value="返回关注列表&#xa;Result.ok(userDTOList)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="6720" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-188" value="Redis Set存储&#xa;&#xa;Key: follows:{userId}&#xa;数据类型: Set&#xa;存储内容: 关注的用户ID集合&#xa;&#xa;示例:&#xa;follows:1010 = &#xa;  {1001, 1002, 1005, 1008}&#xa;&#xa;无TTL（永久存储）" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="450" y="6040" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-189" value="MySQL数据库&#xa;&#xa;tb_user表:&#xa;批量查询关注的用户&#xa;SELECT * FROM tb_user&#xa;WHERE id IN (?, ?, ...)&#xa;&#xa;返回User实体列表" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="450" y="6380" width="280" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-190" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-179" target="Si3AXrKBGMQPG3Cq1DsE-180" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-191" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-180" target="Si3AXrKBGMQPG3Cq1DsE-181" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-192" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-181" target="Si3AXrKBGMQPG3Cq1DsE-182" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-193" value="是" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-182" target="Si3AXrKBGMQPG3Cq1DsE-183" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-194" value="否" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-182" target="Si3AXrKBGMQPG3Cq1DsE-184" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-195" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-184" target="Si3AXrKBGMQPG3Cq1DsE-185" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-196" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-185" target="Si3AXrKBGMQPG3Cq1DsE-186" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-197" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-186" target="Si3AXrKBGMQPG3Cq1DsE-187" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-198" value="SMEMBERS" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-181" target="Si3AXrKBGMQPG3Cq1DsE-188" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-199" value="SELECT IN" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-185" target="Si3AXrKBGMQPG3Cq1DsE-189" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-200" value="【设计说明 - 查询我的关注列表（新功能）】&#xa;&#xa;1. 数据源：Redis Set存储关注关系（follows:{userId}），关注/取关时实时更新&#xa;2. 查询策略：先从Redis获取ID列表，再批量查询MySQL用户详情，避免N+1查询问题&#xa;3. 数据一致性：关注操作时双写Redis+MySQL，保证数据一致性&#xa;4. 性能优化：使用MyBatis-Plus的listByIds批量查询，单次SQL查询多个用户&#xa;5. 返回数据：UserDTO列表（id, nickName, icon），隐藏敏感信息&#xa;&#xa;推荐实现：FollowServiceImpl.java新增方法 getMyFollowingList()" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="6840" width="680" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-201" value="开始: GET /follow/fans&#xa;查询我的粉丝列表" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="800" y="5940" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-202" value="获取当前用户ID&#xa;UserHolder.getUser().getId()" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="800" y="6040" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-203" value="从MySQL查询粉丝列表&#xa;SELECT user_id FROM tb_follow&#xa;WHERE follow_user_id = userId&#xa;（反向查询：谁关注了我）" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="800" y="6140" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-204" value="粉丝列表为空?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="800" y="6280" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-205" value="返回空列表&#xa;Result.ok(emptyList)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="1200" y="6280" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-206" value="提取粉丝用户ID列表&#xa;fanIds = follows.stream()&#xa;  .map(Follow::getUserId)" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="800" y="6380" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-207" value="批量查询粉丝用户信息&#xa;SELECT * FROM tb_user&#xa;WHERE id IN (fanIds)" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="800" y="6500" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-208" value="转换为UserDTO列表&#xa;users.stream().map(user -&gt;&#xa;  BeanUtil.copyProperties(user, UserDTO))" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="800" y="6620" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-209" value="返回粉丝列表&#xa;Result.ok(fanDTOList)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="800" y="6740" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-210" value="MySQL数据库&#xa;&#xa;tb_follow表:&#xa;id, user_id, follow_user_id&#xa;&#xa;反向查询粉丝：&#xa;WHERE follow_user_id = 我的ID&#xa;得到 user_id 列表&#xa;（这些user_id就是粉丝）&#xa;&#xa;无Redis缓存设计" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1200" y="6040" width="280" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-211" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-201" target="Si3AXrKBGMQPG3Cq1DsE-202" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-212" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-202" target="Si3AXrKBGMQPG3Cq1DsE-203" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-213" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-203" target="Si3AXrKBGMQPG3Cq1DsE-204" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-214" value="是" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-204" target="Si3AXrKBGMQPG3Cq1DsE-205" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-215" value="否" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-204" target="Si3AXrKBGMQPG3Cq1DsE-206" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-216" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-206" target="Si3AXrKBGMQPG3Cq1DsE-207" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-217" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-207" target="Si3AXrKBGMQPG3Cq1DsE-208" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-218" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-208" target="Si3AXrKBGMQPG3Cq1DsE-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-219" value="SELECT" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-203" target="Si3AXrKBGMQPG3Cq1DsE-210" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-220" value="SELECT IN" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-207" target="Si3AXrKBGMQPG3Cq1DsE-210" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-221" value="【设计说明 - 查询我的粉丝列表（新功能）】&#xa;&#xa;1. 数据源：直接查询MySQL tb_follow表，使用反向查询（WHERE follow_user_id = 我的ID）&#xa;2. 无Redis缓存：粉丝关系是被动的，不适合用户维度缓存。可以考虑为活跃用户缓存粉丝数量&#xa;3. 性能优化：tb_follow表的follow_user_id字段需要建立索引&#xa;4. 两次查询：先查tb_follow获取粉丝ID列表，再批量查tb_user获取用户详情&#xa;5. 扩展建议：可以添加分页功能（LIMIT, OFFSET），避免粉丝过多时一次返回太多数据&#xa;&#xa;推荐实现：FollowServiceImpl.java新增方法 getMyFans()" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="800" y="6860" width="680" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-222" value="开始: POST /user/logout&#xa;用户登出" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="7100" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-223" value="从请求头获取Token&#xa;Authorization: Bearer {token}&#xa;或从ThreadLocal获取" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="7200" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-224" value="Token为空?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="7320" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-225" value="直接返回成功&#xa;Result.ok()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="450" y="7320" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-226" value="拼接Redis Key&#xa;tokenKey = &quot;login:token:&quot; + token" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="7420" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-227" value="从Redis删除Token&#xa;DEL login:token:{token}&#xa;清除用户会话信息" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="7540" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-228" value="清除ThreadLocal&#xa;UserHolder.removeUser()&#xa;避免内存泄漏" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="7660" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-229" value="返回成功&#xa;Result.ok(&quot;登出成功&quot;)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Comic Sans MS;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="7780" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-230" value="Redis缓存&#xa;&#xa;Key: login:token:{token}&#xa;数据类型: Hash&#xa;存储内容: UserDTO&#xa;{id, nickName, icon}&#xa;&#xa;登出操作：&#xa;DEL命令删除整个Key&#xa;清除用户会话" style="rounded=0;whiteSpace=wrap;html=1;;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="450" y="7440" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-231" value="ThreadLocal清理&#xa;&#xa;UserHolder.removeUser()&#xa;必须清理，否则：&#xa;1. 内存泄漏（线程池环境）&#xa;2. 请求串数据（线程复用）" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="450" y="7660" width="280" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-232" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-222" target="Si3AXrKBGMQPG3Cq1DsE-223" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-233" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-223" target="Si3AXrKBGMQPG3Cq1DsE-224" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-234" value="是" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-224" target="Si3AXrKBGMQPG3Cq1DsE-225" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-235" value="否" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-224" target="Si3AXrKBGMQPG3Cq1DsE-226" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-236" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-226" target="Si3AXrKBGMQPG3Cq1DsE-227" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-237" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-227" target="Si3AXrKBGMQPG3Cq1DsE-228" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-238" value="" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-228" target="Si3AXrKBGMQPG3Cq1DsE-229" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-239" value="DEL" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-227" target="Si3AXrKBGMQPG3Cq1DsE-230" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-240" value="清理" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontFamily=Comic Sans MS;dashed=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" source="Si3AXrKBGMQPG3Cq1DsE-228" target="Si3AXrKBGMQPG3Cq1DsE-231" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Si3AXrKBGMQPG3Cq1DsE-241" value="【设计说明 - 登出功能（新功能）】&#xa;&#xa;1. Token获取：从请求头Authorization或拦截器已解析的ThreadLocal获取&#xa;2. 幂等性设计：Token为空时直接返回成功，允许重复登出，提升用户体验&#xa;3. 清除会话：DEL删除Redis中的login:token:{token}，立即失效用户会话&#xa;4. 清理ThreadLocal：调用UserHolder.removeUser()，避免线程池环境下的内存泄漏&#xa;5. 安全性：登出后Token立即失效，不能再用于访问需要登录的接口&#xa;6. 前端配合：前端需要删除本地存储的Token，并跳转到登录页&#xa;&#xa;推荐实现：UserServiceImpl.java新增方法 logout(String token)&#xa;注意：需要在UserHolder中添加removeUser()静态方法" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontFamily=Comic Sans MS;fontSize=11;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="7900" width="680" height="200" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
